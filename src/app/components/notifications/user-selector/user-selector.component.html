<section class="section">
  <div class="report-table-wrapper">
    <div class="user-selector-container" #containerRef>
      <div class="field relative-container">
        <label class="label">
          Buscar
          {{
            role === 'student'
              ? 'Estudiantes'
              : role === 'instructor'
                ? 'Instructores'
                : role === 'admin'
                  ? 'Administradores'
                  : 'Usuarios'
          }}
        </label>

        <div class="control has-icons-left">
          <input
            class="input"
            type="text"
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange($event)"
            (focus)="onInputFocus()"
            placeholder="Buscar usuario por nombre"
          />
          <span class="icon is-left">
            <i class="fas fa-search"></i>
          </span>
        </div>

        <!-- Dropdown de usuarios -->
        <div class="dropdown-list" *ngIf="isDropdownOpen && allUsers.length > 0">
          <div
            class="dropdown-item"
            *ngFor="let user of allUsers"
            (click)="toggleUserSelection(user)"
            [class.selected]="isSelected(user)"
          >
            <input
              type="checkbox"
              [checked]="isSelected(user)"
              (click)="$event.stopPropagation()"
              (change)="toggleUserSelection(user)"
            />
            {{ user.firstName }} {{ user.lastName }}
          </div>
        </div>

        <!-- Usuarios seleccionados -->
        <div class="selected-users" *ngIf="selectedUsers.length > 0">
          <strong class="selected-label">Seleccionados:</strong>
          <ul>
            <li *ngFor="let user of selectedUsers" class="selected-user-item">
              <span class="user-name">
                {{ user.firstName }} {{ user.lastName }}
              </span>
              <button
                type="button"
                class="delete-btn"
                (click)="removeUser(user)"
                aria-label="Eliminar usuario"
              >
                Ã—
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>