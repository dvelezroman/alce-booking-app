<div class="modal" [class.is-active]="isModalOpen">
  <div class="modal-background"></div>

  <div class="modal-card">
    <header class="modal-card-head">
      <div>
        <p class="modal-card-title">Completar Informaci√≥n</p>
        <p class="modal-subtitle">
          Completa estos datos para continuar usando la plataforma.
        </p>
      </div>
      <button class="delete" aria-label="close" (click)="close()"></button>
    </header>

    <section class="modal-card-body">
      <!-- üëá el *ngIf garantiza que no se renderice hasta tener el form listo -->
      <form *ngIf="infoForm" [formGroup]="infoForm" (ngSubmit)="onSubmit()" id="studentInfoForm">
        <!-- Email -->
        <div class="field">
          <label class="label">Correo electr√≥nico</label>
          <div class="control">
            <input type="email" class="input" formControlName="email" />
          </div>
          <p class="error-message" *ngIf="infoForm.get('email')?.invalid && infoForm.get('email')?.touched">
            Email v√°lido es obligatorio.
          </p>
        </div>

        <!-- Fecha de nacimiento -->
        <div class="field">
          <label class="label">Fecha de nacimiento</label>
          <div class="control">
            <input type="date" class="input" formControlName="birthday" />
          </div>
          <p class="error-message" *ngIf="infoForm.get('birthday')?.invalid && infoForm.get('birthday')?.touched">
            Fecha de nacimiento es requerida.
          </p>
        </div>

        <!-- Tutor (solo aparece si el usuario es STUDENT y menor de edad) -->
        <div class="field" *ngIf="isStudent && isMinor">
          <label class="label">Tutor (opcional)</label>
          <div class="control">
            <div class="select is-fullwidth">
              <select formControlName="tutorId">
                <option value="">Seleccione un tutor</option>
                <option *ngFor="let t of tutors" [value]="t.id">{{ t.fullName }}</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Tel√©fono -->
        <div class="field">
          <label class="label">N√∫mero de contacto</label>
          <div class="field is-grouped">
            <div class="control" style="min-width: 120px">
              <div class="select is-fullwidth">
                <select formControlName="countryCode">
                  <option *ngFor="let code of countryCodes" [value]="code.code">
                    {{ code.name }} ({{ code.code }})
                  </option>
                </select>
              </div>
            </div>

            <div class="control is-expanded">
              <input type="tel" class="input" formControlName="phoneNumber" />
            </div>
          </div>
          <p class="error-message" *ngIf="infoForm.get('phoneNumber')?.invalid && infoForm.get('phoneNumber')?.touched">
            N√∫mero de tel√©fono es obligatorio.
          </p>
        </div>

        <div class="field">
          <label class="label">Ocupaci√≥n</label>
          <div class="control">
            <input
              type="text"
              class="input"
              formControlName="occupation"
              placeholder="Ej. Profesor de Ingl√©s"
            />
          </div>
          <p
            class="error-message"
            *ngIf="infoForm.get('occupation')?.touched && infoForm.get('occupation')?.invalid"
          >
            La ocupaci√≥n es obligatoria.
          </p>
        </div>

        <!-- Pa√≠s -->
        <div class="field">
          <label class="label">Pa√≠s</label>
          <div class="control">
            <div class="select is-fullwidth">
              <select formControlName="country" (change)="onCountryChange($event)">
                <option *ngFor="let country of countryCodes" [value]="country.iso">
                  {{ country.name }}
                </option>
              </select>
            </div>
          </div>
          <p class="error-message" *ngIf="infoForm.get('country')?.invalid && infoForm.get('country')?.touched">
            Pa√≠s es requerido.
          </p>
        </div>

        <!-- Ciudad -->
        <div class="field">
          <label class="label">Ciudad</label>
          <div class="control">
            <div class="select is-fullwidth">
              <select formControlName="city">
                <option value="" disabled>Seleccione una ciudad</option>
                <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
              </select>
            </div>
          </div>
          <p class="error-message" *ngIf="infoForm.get('city')?.invalid && infoForm.get('city')?.touched">
            Ciudad es requerida.
          </p>
        </div>
      </form>
    </section>

    <footer class="modal-card-foot">
      <button type="submit" class="button is-primary" form="studentInfoForm">
        Guardar
      </button>
    </footer>
  </div>
</div>

<app-modal
  [showModal]="modal.show"
  [message]="modal.message"
  [isError]="modal.isError"
  [isSuccess]="modal.isSuccess"
  [title]="modal.title || ''"
  (close)="modal.close()"
></app-modal>