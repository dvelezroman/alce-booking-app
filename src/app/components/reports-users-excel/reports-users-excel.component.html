<!-- FORMULARIO: Usuarios -->
<div class="users-excel-form" *ngIf="mode === 'users'">
  <h3>Descargar Excel de Usuarios</h3>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="filters-form">

    <div class="field">
      <label class="label">Rol <span class="required">*</span></label>
      <select formControlName="role" class="input">
        <option value="">Seleccionar rol</option>
        <option *ngFor="let r of userRoles" [value]="r">{{ r }}</option>
      </select>
      <div class="error" *ngIf="form.get('role')?.invalid && form.get('role')?.touched">
        Debe seleccionar un rol.
      </div>
    </div>

    <div class="field">
      <label class="label">Estado</label>
      <select formControlName="status" class="input">
        <option value="">Todos</option>
        <option *ngFor="let s of userStatuses" [value]="s">{{ s }}</option>
      </select>
    </div>

    <!-- Campo Stage solo visible para rol Student -->
    <div class="field" *ngIf="showStage()">
      <label class="label">Stage</label>
      <select formControlName="stageId" class="input">
        <option value="">Todos</option>
        <option *ngFor="let st of stages" [value]="st.id">{{ st.description }}</option>
      </select>
    </div>

    <div class="field checkbox" *ngIf="showStage()">
      <label>
        <input type="checkbox" formControlName="noClasses" />
        Solo estudiantes sin clases
      </label>
    </div>

    <div class="actions">
      <button type="submit" class="button">Descargar Excel</button>
      <button type="button" class="button secondary" (click)="resetFilters()">Limpiar</button>
    </div>
  </form>
</div>

<!-- FORMULARIO: Inasistencias -->
<div class="users-excel-form" *ngIf="mode === 'absents'">
  <h3>Descargar Excel de Inasistencias</h3>

  <form [formGroup]="absentForm" (ngSubmit)="onSubmit()" class="filters-form">

    <div class="field">
      <label class="label">Instructor <span class="required">*</span></label>
      <select formControlName="instructorId" class="input">
        <option value="">Seleccionar instructor</option>
        <option *ngFor="let i of instructors" [value]="i.id">
          {{ i.user?.firstName }} {{ i.user?.lastName }}
        </option>
      </select>
      <div class="error" *ngIf="absentForm.get('instructorId')?.invalid && absentForm.get('instructorId')?.touched">
        Debe seleccionar un instructor.
      </div>
    </div>

    <div class="field">
      <label class="label">Desde <span class="required">*</span></label>
      <input type="date" formControlName="from" class="input" />
      <div class="error" *ngIf="absentForm.get('from')?.invalid && absentForm.get('from')?.touched">
        La fecha de inicio es obligatoria.
      </div>
    </div>

    <div class="field">
      <label class="label">Hasta <span class="required">*</span></label>
      <input type="date" formControlName="to" class="input" />
      <div class="error" *ngIf="absentForm.get('to')?.invalid && absentForm.get('to')?.touched">
        La fecha de fin es obligatoria.
      </div>
    </div>

    <div class="field">
      <label class="label">Stage (opcional)</label>
      <select formControlName="stageId" class="input">
        <option value="">Todos</option>
        <option *ngFor="let st of stages" [value]="st.id">{{ st.description }}</option>
      </select>
    </div>

    <div class="actions">
      <button type="submit" class="button">Descargar Excel</button>
      <button type="button" class="button secondary" (click)="absentForm.reset()">Limpiar</button>
    </div>
  </form>
</div>