<div class="class-booking-header">
  <h1 class="title is-3">Book your classes</h1>
</div>

<div class="booking-container container">
     <div class="columns is-mobile">

        <!-- primer bloque: información del estudiante -->
       <div class="column student-info">
        
            <!-- <div class="student-photo">
                <img src="/assets/foto usuario default.png" alt="Foto del estudiante">
              </div> -->
            <div class="student-name">
              <h3>{{ userName() }}</h3>
            </div>
            <div class="student-details">
              <p>{{ userData?.email }}</p>
            </div>
            <div class="student-detail">
              <p>{{ userData?.stage?.description }}</p>
            </div>

          <!-- Fechas seleccionadas por el usuario student -->
          <div class="student-schedule" *ngIf="meetings.length > 0">
            <h4 class="schedule-title">Horario Seleccionado</h4>
            
            <!-- Botón de flecha izquierda -->
            <button class="scroll-button left" (click)="scrollLeft()" [class.hidden]="!canScrollLeft">
              <i class="fas fa-chevron-left"></i>
            </button>
          
            <div class="schedule-list"  #scheduleList>
              <div *ngFor="let meeting of meetings; let i = index" class="schedule-item">
                <div class="meeting-title">
                  <strong>Meeting {{ i + 1 }}</strong>
                </div>
                <div class="meeting-info-container">
                  <div class="schedule-info">
                    <strong>Fecha:</strong> <span>{{ meeting.date | date: 'mediumDate' }}</span><br>
                    <strong>Hora:</strong> <span>{{ meeting.hour }}:00</span>
                  </div>
                  <div class="schedule-delete">
                    <button class="delete-button">
                      <i class="fas fa-trash-alt" (click)="openDeleteModal(meeting)"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          
            <!-- Botón de flecha derecha -->
            <button class="scroll-button right" (click)="scrollRight()" [class.hidden]="!canScrollRight">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
            <!-- si no ha elegido fecha -->
            <div class="no-meeting" *ngIf="meetings.length === 0">
              <p>No tienes fechas de clases programadas.</p>
            </div>
       </div>
    </div>


    <!-- Segundo bloque: calendario y time slots-->
    <div class="date-time-wrapper">

      <!-- sub-bloque 1: Calendario -->
      <div class="date-time-selection">
        <div class="calendar-title">
          <h3 class="title is-4">Select a date</h3>
        </div>
        <div class="month-selector">
          <button *ngIf="canGoBack" class="button is-small prev-button" (click)="prevMonth()">
            <i class="fas fa-chevron-left"></i>
          </button>
          <span class="month-label">{{ selectedMonth }} {{ selectedYear }}</span>
          <button *ngIf="canGoForward" class="button is-small next-button" (click)="nextMonth()">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="calendar">
          <div class="calendar-header">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
          </div>
          <div class="calendar-grid">
            <div
              *ngFor="let day of currentMonthDays"
              class="calendar-day"
              (click)="isDaySelectable(day) ? selectDay(day) : null"
              [class.selected]="selectedDay === day.day"
              [class.selectable]="isDaySelectable(day)"
              [class.unselectable]="!isDaySelectable(day)">
              {{ day.day }}
            </div>
          </div>
          </div>
      </div>
      

      <!-- Sub-bloque 2: Time Slots -->
      <div class="selected-date-time">
          <h3 class="title is-3">Select a time</h3>
          <button class="scroll-arrow-up" (click)="scrollUp()" [class.disabled]="!canScrollUp">
            <i class="fas fa-chevron-up"></i>
          </button>
        <div class="time-slots" #timeSlotList>
          <div *ngFor="let time of timeSlots; let i = index"
               class="time-slot"
               (mouseenter)="hoverIndex = i"
               (mouseleave)="hoverIndex = null">
            <div class="time-text-container">
              <span class="time-text">{{ time.label }}</span>
            </div>
            <div class="confirm-box" *ngIf="hoverIndex === i" (click)="selectTimeSlot(time)">
              Confirm
            </div>
          </div>
        </div>
        <button class="scroll-arrow-down" (click)="scrollDown()" [class.disabled]="!canScrollDown">
          <i class="fas fa-chevron-down"></i>
        </button>
      </div>

    </div>
</div>




<!-- Modal de error -->
<div *ngIf="showModal" class="modal-overlay">
  <div class="modal-content error-modal">
    <i class="fas fa-exclamation-circle error-icon"></i>
    <p class="help is-danger bold-text">You must select a date</p>
    <p class="help is-danger small-text">before choosing a time slot.</p>
  </div>
</div>

<!-- Modal de error por meeting repetida -->
<div *ngIf="showModalBookingError" class="modal-overlay booking-error-modal">
  <div class="modal-content booking-error-content">
    <i class="fas fa-exclamation-circle error-icon"></i>
    <p class="help is-danger bold-text">
      Ya tienes una meeting agendada en la fecha y hora seleccionada.
    </p>
  </div>
</div>

<!-- Modal exitoso con botones para confirmar o cancelar -->
<div *ngIf="showSuccessModal" class="modal-overlay">
  <div class="modal-content success-modal">
    <i class="fas fa-question-circle question-icon"></i>
    <p>You have selected <br> {{ selectedDayFormatted }} at {{ selectedTimeSlot.label }}</p>
    <!-- Confirmation and cancellation buttons -->
    <div class="modal-buttons">
      <button class="button is-success" (click)="bookMeeting()">Accept</button>
      <button class="button is-danger" (click)="cancelSelection()">Cancel</button>
    </div>
  </div>
</div>


<!-- Modal de successful-->
<div *ngIf="showInfoModal" class="modal-overlay">
  <div class="modal-content info-modal">
    <i class="fas fa-check-circle info-icon"></i>
    <p>Your selection was successful!</p>
  </div>
</div>


<!-- Modal de confirmación para eliminar meeting-->
<div class="modal" [ngClass]="{ 'is-active': isDeleteModalActive }">
  <div class="modal-background"></div>
  <div class="modal-card">
    <section class="modal-card-body">
      <p>¿Estás seguro de que deseas eliminar esta reunión?</p>
    </section>
    <footer class="modal-card-foot">
      <button class="button is-primary3" (click)="closeDeleteModal()">Cancelar</button>
      <button class="button is-danger2" (click)="confirmDelete()">Eliminar</button>
    </footer>
  </div>
</div>
