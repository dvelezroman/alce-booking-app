<section class="section whatsapp-section">
  <div class="content">
    <h1 class="reports-progress-header reports-progress-title">Mensajes Enviados</h1>

    <!-- Bloque único -->
    <div class="card card--padded big-block">
      <!-- Filtros -->
      <div class="filters">
        <label>
          Estado:
          <select [(ngModel)]="filters.status" (change)="onFiltersChange()">
            <option value="">Todos</option>
            <option value="SENT">Enviados</option>
            <option value="DELIVERED">Entregados</option>
            <option value="READ">Leídos</option>
            <option value="FAILED">Fallidos</option>
          </select>
        </label>

        <label>
          Tipo destino:
          <select [(ngModel)]="filters.recipientType" (change)="onFiltersChange()">
            <option value="">Todos</option>
            <option value="INDIVIDUAL">Individual</option>
            <option value="GROUP">Grupo</option>
            <option value="BROADCAST">Difusión</option>
          </select>
        </label>

        <label>
          Fecha inicio:
          <input type="date" [(ngModel)]="filters.startDate" (change)="onFiltersChange()" />
        </label>

        <label>
          Fecha fin:
          <input type="date" [(ngModel)]="filters.endDate" (change)="onFiltersChange()" />
        </label>
      </div>

     <!-- Input búsqueda destinatario -->
      <div class="search-block">
        <div class="search-input-wrapper">
          <!-- Icono SVG (Heroicons lupa) -->
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1010.5 18.5a7.5 7.5 0 006.15-3.85z" />
          </svg>

          <input
            type="text"
            [(ngModel)]="filters.recipientName"
            (ngModelChange)="onRecipientSearch($event)"
            placeholder="Buscar por nombre del destinatario..."
          />
        </div>
      </div>

      <!-- Contador de mensajes -->
      <div class="messages-counter" *ngIf="!loading">
        Total mensajes: <strong>{{ filteredCount }}</strong>
      </div>

      <!-- Error (opcional) -->
      <div *ngIf="error" class="error-msg">{{ error }}</div>

      <!-- Lista de mensajes -->
      <div class="messages-container">
        <app-message-list
          [messages]="messages"
          [loading]="loading"
          [error]="error">
        </app-message-list>
      </div>

      <!-- Paginación -->
      <div class="pagination" *ngIf="totalMessages > 0">
        <button
          class="pg-btn"
          (click)="onPrev()"
          [disabled]="page === 1"
          aria-label="Página anterior">
          ‹
        </button>

        <span class="pg-info">
          Página {{ page }}
          <span class="sep">·</span>
          Mostrando {{ startIndex }} – {{ endIndex }} de {{ totalMessages }}
        </span>

        <button
          class="pg-btn"
          (click)="onNext()"
          [disabled]="page * limit >= totalMessages"
          aria-label="Página siguiente">
          ›
        </button>
      </div>
    </div>
  </div>
</section>