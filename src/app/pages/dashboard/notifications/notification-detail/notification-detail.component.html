<section class="notif-detail-root">
  <!-- Top bar / actions -->
  <header class="topbar">
    <div class="left">
      <a class="btn back" (click)="goBack()" aria-label="Volver">
        ‚Üê
      </a>
    </div>

    <div class="right">
      <div class="actions">
        <button class="icon-btn" title="Eliminar" *ngIf="isAdmin"
        (click)="onDeleteClick()"
        [disabled]="deleting">üóëÔ∏è</button>
        <button class="icon-btn" title="M√°s">‚ãÆ</button>
      </div>
    </div>
  </header>

  <!-- Main column only -->
  <div class="layout single">
    <article class="message-col">
      <!-- From block -->
      <div class="from-row">
        <div class="avatar">
            <span>
            {{
                (notification?.fromUser?.firstName ||
                notification?.fromUser?.lastName ||
                notification?.fromUser?.email ||
                'N') | slice: 0:1
            }}
            {{ (notification?.fromUser?.lastName || '') | slice: 0:1 }}
            </span>
        </div>

        <div class="from-meta">
            <div class="from-line">
            <strong class="name">
                {{ notification?.fromUser?.firstName }} {{ notification?.fromUser?.lastName }}
            </strong>
            <span class="email" *ngIf="!notification?.fromUser?.firstName && !notification?.fromUser?.lastName">
                {{ notification?.fromUser?.email }}
            </span>
            <span class="dot">¬∑</span>
            <span class="time">
                {{ notification?.createdAt | date: 'EEE d MMM y, HH:mm' }}
            </span>
            </div>

            <div class="to-line">
              Para: <span class="audience">{{ audienceLine }}</span>
            </div>

            <!-- Nuevo bloque: t√≠tulo del mensaje -->
            <div class="title-line" *ngIf="notification?.title">
            {{ notification?.title }}
            </div>
        </div>
      </div>

      <!-- DETAILS -->
      <details class="meta-disclosure">
        <summary>
          <span>Detalles</span>
          <span class="chev" aria-hidden="true">‚ñæ</span>
        </summary>

        <div class="card details-card">
          <dl class="meta-list">
            <div class="row"><dt>Estado</dt><dd>{{ estadoLabel }}</dd></div>
            <!-- <div class="row"><dt>Creada</dt><dd>{{ notification?.createdAt | date: 'short' }}</dd></div> -->
            <div class="row" *ngIf="notification?.sentAt"><dt>Enviada</dt><dd>{{ notification?.sentAt | date: 'short' }}</dd></div>
            <!-- <div class="row" *ngIf="notification?.deliveredAt"><dt>Entregada</dt><dd>{{ notification?.deliveredAt | date: 'short' }}</dd></div> -->
            <!-- <div class="row" *ngIf="notification?.updatedAt"><dt>Actualizada</dt><dd>{{ notification?.updatedAt | date: 'short' }}</dd></div> -->
            <div class="row" *ngIf="notification?.expiresAt"><dt>Expira</dt><dd>{{ notification?.expiresAt | date: 'short' }}</dd></div>
            <div class="row"><dt>Tipo</dt><dd>{{ tipoLabel }}</dd></div>
            <div class="row" *ngIf="notification?.priority !== null && notification?.priority !== undefined">
                <dt>Prioridad</dt><dd>{{ prioridadLabel }}</dd>
            </div>
            <div class="row"><dt>√Åmbito</dt><dd>{{ notification?.scope }}</dd></div>
            <!-- <div class="row" *ngIf="notification?.message?.action">
              <dt>Acci√≥n</dt><dd>{{ notification?.message?.action }}</dd>
            </div> -->
            <!-- <div class="row" *ngIf="notification?.metadata">
              <dt>Metadata</dt>
              <dd>{{ notification?.metadata | json }}</dd>
            </div> -->
          </dl>
        </div>
      </details>

      <!-- Content -->
      <div class="content">
        <p class="body-text" *ngIf="notification?.message?.body as body">
          {{ body }}
        </p>
      </div>

      <section
        class="recipients-card card"
        *ngIf="showRecipients && recipientIds.length"
      >
        <header class="recipients-header">
          <h3 class="section-title">
            Destinatarios <span class="count">({{ recipientIds.length }})</span>
          </h3>
        </header>

        <div class="recipients-list">
          <span
            class="chip"
            *ngFor="let uid of recipientIds; trackBy: trackByUid"
            [class.read]="isReadBy(uid)"
          >
            ID {{ uid }}
          </span>
        </div>
      </section>

      <!-- Banners opcionales -->
      <div class="alert warn" *ngIf="notification?.expiresAt">
        Esta notificaci√≥n tiene fecha de caducidad.
      </div>
      <div class="alert danger" *ngIf="notification?.status === 'FAILED'">
        {{ notification?.errorMessage || 'No se pudo entregar.' }}
      </div>
    </article>
  </div>
</section>

<app-modal
  [showModal]="modal.show"
  [message]="modal.message"
  [isError]="modal.isError"
  [isSuccess]="modal.isSuccess"
  [isInfo]="modal.isInfo"
  [title]="modal.title || ''"
  [showButtons]="modal.showButtons ?? false"
  (confirmAction)="modal.confirm && modal.confirm()"
  (close)="modal.close()"
></app-modal>