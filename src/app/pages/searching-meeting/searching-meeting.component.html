<section class="section">
  <div class="container">

    <div class="block title-container">
      <h1 class="title">Buscar Meeting</h1>
    </div>

    <div class="block-search">
      <form>
        <!-- Inputs de fecha -->
        <div class="columns is-mobile">
          <div class="column">
            <div class="field">
              <label class="label">Fecha desde</label>
              <div class="control">
                <input class="input" type="date" [(ngModel)]="filter.from" name="from" (ngModelChange)="onFilterChange()">
              </div>
            </div>
          </div>

          <div class="column">
            <div class="field">
              <label class="label">Fecha hasta</label>
              <div class="control">
                <input class="input" type="date" [(ngModel)]="filter.to" name="to" (ngModelChange)="onFilterChange()">
              </div>
            </div>
          </div>
        </div>

        <!-- Inputs de hora y stage -->
        <div class="columns is-mobile">
          <!-- Input de hora -->
          <div class="column">
            <div class="field">
              <label class="label">Hora</label>
              <div class="control">
                <div class="select is-fullwidth">
                  <select [(ngModel)]="filter.hour" name="hour" (ngModelChange)="onFilterChange()">
                    <option value="">Todas las horas</option>
                    <option *ngFor="let hour of availableHours" [value]="hour">{{ hour }}:00</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Input de stage -->
          <div class="column">
            <div class="field">
              <label class="label">Stage</label>
              <div class="control">
                <div class="select is-fullwidth">
                  <select [(ngModel)]="filter.stageId" name="stageId" (ngModelChange)="onFilterChange()">
                    <option value="">Stages</option>
                    <!-- Opciones de stages disponibles -->
                    <option *ngFor="let stage of stages" [value]="stage.number">{{ stage.description }}</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

     <!-- Botón de asignar (aparece cuando hay resultados) -->
     <div class="block" *ngIf="meetings && meetings.length > 0">
      <div class="field">
        <label class="label">&nbsp;</label>
        <div class="control">
          <button class="button is-primary is-fullwidth" (click)="openModal()">Asignar Link Meeting</button>
        </div>
      </div>
    </div>

    <!-- Resultados de la búsqueda -->
    <div class="block-results">
      <div class="view-switcher" *ngIf="meetings && meetings.length > 0">
        <button class="icon-button" (click)="viewMode = 'table'">
          <i class="fas fa-th-list"></i> 
        </button>
        <button class="icon-button" (click)="viewMode = 'list'">
          <i class="fas fa-table"></i> 
        </button>
      </div>
    
      <!-- Vista de tabla -->
      <table class="table-results" *ngIf="viewMode === 'table' && meetings && meetings.length > 0">
        <thead>
          <tr>
            <th>Stage</th>
            <th>Nombre</th>
            <th>Correo</th>
            <th>Fecha</th>
            <th>Hora</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let meeting of meetings">
            <td>{{ meeting.stageId }}</td>
            <td>{{ meeting.student?.user?.firstName }} {{ meeting.student?.user?.lastName }}</td>
            <td>{{ meeting.student?.user?.email || 'Correo no disponible' }}</td>
            <td>{{ meeting.date | date: 'mediumDate' }}</td>
            <td>{{ meeting.hour }}:00</td>
          </tr>
        </tbody>
      </table>
    
      <!-- Vista de tarjetas -->
      <ul class="card-results" *ngIf="viewMode === 'list' && meetings && meetings.length > 0">
        <li *ngFor="let meeting of meetings; let i = index">
          <div class="meeting-item">
            <div class="meeting-stage">
              <strong>Stage: </strong> {{ meeting.stageId }}
            </div>
            <div class="meeting-student">
              <strong>Nombre:</strong> {{ meeting.student?.user?.firstName }} {{ meeting.student?.user?.lastName }}
            </div>
            <div class="meeting-email">
              <strong>Correo:</strong> {{ meeting.student?.user?.email || 'Correo no disponible' }}
            </div>
            <div class="meeting-date-hour">
              <strong>Fecha:</strong> {{ meeting.date | date: 'mediumDate' }}
              <strong>Hora:</strong> {{ meeting.hour }}:00
            </div>
          </div>
        </li>
      </ul>
    
      <p *ngIf="filter.from && filter.to && meetings && meetings.length === 0" class="no-results-message">
        No hay estudiantes para el rango asignado.
      </p>
    </div>
  </div>
</section>

  <div class="modal" [ngClass]="{ 'is-active': isModalOpen }">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Asignar Link</p>
      </header>
      <section class="modal-card-body">
        <!-- Primer bloque: Input para el link -->
        <div class="field">
          <label class="label"></label>
          <div class="control">
            <input class="input" type="text" [(ngModel)]="link" placeholder="Ingrese el link">
          </div>
        </div>
      </section>
      <footer class="modal-card-foot">
        <!-- Segundo bloque: Botones -->
        <button class="button is-danger" (click)="closeModal()">Cancelar</button>
        <button class="button is-primary2" (click)="assignLink()">Asignar</button>
      </footer>
    </div>
  </div>
